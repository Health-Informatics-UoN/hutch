import { Callout } from "nextra/components";
import { Steps } from "nextra/components";

# Relay Deployment

This page will guide you through getting Relay deployed in a Virtual Machine (VM).

## Prerequisites

- A VM with these apps installed
  - [Docker](https://knowledgebase.aridhia.io/workspaces/analysing-data/virtual-machines/installing-software-on-virtual-machines/installing-docker-on-your-virtual-machine) and [Docker Compose](https://docs.docker.com/compose/install/)
  - [wget](https://phoenixnap.com/kb/wget-command-with-examples#:~:text=wget%20is%20a%20free%20GNU,this%20tutorial%20uses%20Ubuntu%2022.04)
- A PostgreSQL 16+ Database Server accessible from the VM

## Deployment Steps

### Get the example Compose file

Download the example of Relay's Compose file by running the command:

```bash copy
wget https://raw.githubusercontent.com/Health-Informatics-UoN/hutch/refs/heads/main/samples/Bunny/relay.compose.yml
```

### Environment configuration

Modify the configuration of the newly downloaded `relay.compose.yml` file as described in [Configuring Relay](/relay/config)

You will need to [configure the database connection](/relay/config#database), and your [Upstream Task API host connection](/relay/config#upstream-task-api)

## Running Relay

At the directory containing the `relay.compose.yml` file, run the command to activate Relay:

```bash copy
docker compose up
```

You should then see a message in your console like this:

```bash
relay-1     | info: Microsoft.Hosting.Lifetime[14]
relay-1     |       Now listening on: http://[::]:8080
relay-1     | info: Microsoft.Hosting.Lifetime[0]
relay-1     |       Application started. Press Ctrl+C to shut down.
relay-1     | info: Microsoft.Hosting.Lifetime[0]
relay-1     |       Hosting environment: Production
relay-1     | info: Microsoft.Hosting.Lifetime[0]
relay-1     |       Content root path: /app
```

Relay establishes a connection to your upstream Task API server, then polls for a task.
When it receives a task, it enqueues it for each configured downstream SubNode.
When results have been received from all SubNodes, Relay passes the aggregated results back to the upstream Task API.

<Callout emoji="ðŸŽ‰">Congratulations on your first Relay deployment!</Callout>
